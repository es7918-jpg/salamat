<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
  <title>شبکه سلامت – بله</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0ea5e9">
  <style>
    :root { --brand:#0ea5e9; }
    * { box-sizing:border-box }
    body{font-family:tahoma,arial,sans-serif;margin:0;background:#f9fafb;color:#111;
         max-width:420px;margin:0 auto;display:flex;flex-direction:column;height:100vh}
    header{padding:14px;text-align:center;font-weight:700;font-size:18px;
            background:linear-gradient(90deg,#0ea5e9,#06b6d4);color:#fff;position:sticky;top:0;z-index:2}
    main{flex:1;overflow-y:auto;padding:12px}
    .tabs{display:flex;justify-content:space-around;border-top:1px solid #e5e7eb;
           background:#fff;position:sticky;bottom:0;z-index:2}
    .tabbtn{flex:1;padding:12px 0;font-size:13px;border:0;background:none;cursor:pointer}
    .tabbtn.active{color:var(--brand);font-weight:bold}
    .catgrid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .catbtn{padding:20px;border-radius:16px;color:#fff;text-align:right;
            font-size:14px;font-weight:bold;cursor:pointer;min-height:100px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
    .cat-mental{background:linear-gradient(135deg,#06b6d4,#0ea5e9)}
    .cat-nutrition{background:linear-gradient(135deg,#22c55e,#84cc16)}
    .cat-dental{background:linear-gradient(135deg,#6366f1,#a78bfa)}
    .cat-disease{background:linear-gradient(135deg,#f43f5e,#fb923c)}
    .cat-family{background:linear-gradient(135deg,#ec4899,#f472b6)}
    .card{background:#fff;border-radius:16px;box-shadow:0 2px 8px rgba(0,0,0,.05);
          margin-bottom:12px;overflow:hidden;border:1px solid #eef2f7}
    .card h3{margin:0;font-size:15px;padding:10px}
    .card p{margin:0;padding:0 10px 10px;font-size:13px;color:#374151;line-height:1.7;white-space:pre-wrap}
    .player img,.player video{width:100%;display:block;background:#000}
    input.search{width:100%;padding:10px;border:1px solid #ddd;border-radius:12px;font-size:14px}
    .back{margin-bottom:10px;padding:6px 12px;border-radius:12px;border:1px solid #ddd;
          background:#fff;cursor:pointer;font-size:13px}
    .muted{color:#64748b;font-size:12px;text-align:center;margin:8px 0}
  </style>
</head>
<body>
  <header>شبکه سلامت</header>
  <main id="app"></main>
  <nav class="tabs">
    <button class="tabbtn" data-tab="home">خانه</button>
    <button class="tabbtn" data-tab="explore">اکسپلور</button>
    <button class="tabbtn" data-tab="search">جستجو</button>
    <button class="tabbtn" data-tab="about">درباره ما</button>
  </nav>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzW9rvRuPy2KNVVXXr3AV4cEGb62pkoCUyQ-HysyG2OVD1VqA28vWAIWf9-dmVyD3w8ng/exec";
const CAT_TITLES={mental:"سلامت روان",nutrition:"تغذیه",dental:"دهان و دندان",disease:"بیماری‌ها",family:"سلامت خانواده"};
const state={tab:'home',activeCat:null,lists:{mental:[],nutrition:[],dental:[],disease:[],family:[]},explore:[],searchPool:[],q:''};
const app=document.getElementById('app');

function esc(s){return String(s||'').replace(/[&<>"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]))}
function renderCards(list){if(!list.length)return'<p class="muted">موردی نیست</p>';
return list.map(p=>'<div class="card">'
  +'<h3>'+esc(p.title||'پست')+'</h3>'
  +(p.text?'<p>'+esc(p.text)+'</p>':'')
  +(p.kind==='photo'&&p.file_url?'<div class="player"><img src="'+p.file_url+'"></div>':'')
  +(p.kind==='video'&&p.file_url?'<div class="player"><video controls playsinline preload="metadata" src="'+p.file_url+'"></video></div>':'')
  +'</div>').join('')}

function render(){
  let html="";
  if(state.tab==='home'){
    if(!state.activeCat){
      html='<div class="catgrid">'
        +'<div class="catbtn cat-mental" data-gocat="mental">سلامت روان</div>'
        +'<div class="catbtn cat-nutrition" data-gocat="nutrition">تغذیه</div>'
        +'<div class="catbtn cat-dental" data-gocat="dental">دهان و دندان</div>'
        +'<div class="catbtn cat-disease" data-gocat="disease">بیماری‌ها</div>'
        +'<div class="catbtn cat-family" data-gocat="family">سلامت خانواده</div>'
        +'</div>';
    }else{
      const k=state.activeCat, lst=state.lists[k]||[];
      html='<button class="back" data-back="1">← بازگشت</button><h2 style="margin:6px 0">'+CAT_TITLES[k]+'</h2>'+renderCards(lst);
    }
  }else if(state.tab==='explore'){ html=renderCards(state.explore); }
  else if(state.tab==='search'){
    html='<input class="search" id="q" placeholder="جستجو...">';
    const q=state.q.trim().toLowerCase();
    const results=q?state.searchPool.filter(p=>((p.title||'')+' '+(p.text||'')).toLowerCase().includes(q)):[];
    html+=results.length?renderCards(results):'<p class="muted">کلیدواژه را بنویسید…</p>';
  }else html='<p style="padding:16px;line-height:1.8">این نسخه‌ی موبایلی شبکه سلامت است. داده‌ها از کانال بله خوانده می‌شوند. می‌توانید از منو پایین جابه‌جا شوید و از «افزودن به صفحهٔ اصلی» آن را مثل اپ نصب کنید.</p>';
  app.innerHTML=html;
  document.querySelectorAll('.tabbtn').forEach(b=>b.classList.toggle('active',b.dataset.tab===state.tab));
  app.onclick=e=>{const k=e.target.getAttribute('data-gocat');if(k){state.activeCat=k;render();return} if(e.target.getAttribute('data-back')){state.activeCat=null;render()}};
  const qi=document.getElementById('q');if(qi)qi.oninput=()=>{state.q=qi.value;render()};
}

async function load(){
  try{const res=await fetch(API_URL);const data=await res.json();const raw=data.items||[];
    const lists={mental:[],nutrition:[],dental:[],disease:[],family:[]},mix=[];
    raw.forEach(it=>{if(it.cat&&lists[it.cat])lists[it.cat].push(it);mix.push(it)});
    state.lists=lists;state.explore=mix;state.searchPool=mix;render();
  }catch(e){app.innerHTML='<p class="muted" style="color:#e11d48">خطا در ارتباط با API</p>';console.error(e);}
}

document.querySelectorAll('.tabs .tabbtn').forEach(btn=>btn.onclick=()=>{state.tab=btn.dataset.tab;if((state.tab==='explore'||state.tab==='search')&&!state.explore.length)load();render()});
render();load();

if('serviceWorker' in navigator){ window.addEventListener('load',()=>navigator.serviceWorker.register('sw.js').catch(console.warn)); }
</script>
</body>
</html>
