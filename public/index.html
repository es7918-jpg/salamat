<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>شبکه سلامت (Eitaa)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: Vazirmatn, sans-serif; }
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <div id="root"></div>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script>
    const CHANNELS = {
      mental: 'bedasht_ravan',
      nutrition: 'bedasht_ravan',
      dental: 'bedasht_ravan',
      diseases: 'bedasht_ravan',
      family: 'bedasht_ravan',
    };
    const CATEGORIES = [
      { key:'mental', title:'سلامت روان', color:'from-sky-500 to-cyan-500' },
      { key:'nutrition', title:'تغذیه', color:'from-emerald-500 to-lime-500' },
      { key:'dental', title:'دهان و دندان', color:'from-indigo-500 to-violet-500' },
      { key:'diseases', title:'بیماری‌ها', color:'from-rose-500 to-orange-500' },
      { key:'family', title:'سلامت خانواده', color:'from-fuchsia-500 to-pink-500' },
    ];

    async function fetchChannel(channel){
      const url = https://r.jina.ai/https://eitaa.com/${encodeURIComponent(channel)};
      const res = await fetch(url);
      if(!res.ok) throw new Error('proxy fetch failed');
      const html = await res.text();

      // استخراج آیدی پست‌ها
      const re = new RegExp(/${channel}/(\\d+),'g');
      const ids = Array.from(new Set(Array.from(html.matchAll(re)).map(m=>m[1]))).slice(0, 10);

      return ids.map(id=>{
        const link = https://eitaa.com/${channel}/${id};
        const idx = html.indexOf(/${channel}/${id});
        const win = idx>=0 ? html.slice(Math.max(0,idx-1000), Math.min(html.length, idx+1000)) : '';
        const text = (win.replace(/<[^>]*>/g,' ').replace(/\s+/g,' ').trim()||'').slice(0,200);
        const imgMatch = win.match(/https?:\/\/[^"'<>\\s]+?\.(?:jpg|jpeg|png|gif)/i);
        return {id, title:پست #${id}, caption:text, cover: imgMatch?imgMatch[0]:'', link};
      });
    }

    function App(){
      const [posts,setPosts]=React.useState([]);
      const [loading,setLoading]=React.useState(false);

      React.useEffect(()=>{
        (async()=>{
          setLoading(true);
          const items=await fetchChannel(CHANNELS.mental);
          setPosts(items);
          setLoading(false);
        })();
      },[]);

      return React.createElement('div',{className:'max-w-md mx-auto p-4 space-y-4'},
        React.createElement('h1',{className:'text-xl font-bold'},'پست‌های کانال سلامت'),
        loading?React.createElement('p',null,'در حال بارگذاری…'):
        posts.map(p=>React.createElement('div',{key:p.id,className:'border rounded-lg p-3 space-y-2 bg-white shadow'},
          p.cover?React.createElement('img',{src:p.cover,className:'w-full rounded'}):null,
          React.createElement('h2',{className:'font-semibold'},p.title),
          React.createElement('p',{className:'text-sm text-slate-600'},p.caption),
          React.createElement('a',{href:p.link,target:'_blank',className:'text-sky-600 text-sm'},'مشاهده در ایتا')
        ))
      );
    }

    const root=ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>
